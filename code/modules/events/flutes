///Add Flute noises for event
//randomly pick people from a short list
//add ability to cure sanity instability with psychatrist
//add sprites?
//add goals?
//xoxeyos

/datum/round_event_control/flutes
	name = "Flutes"
	typepath = /datum/round_event/flutes
	max_occurrences = 1
  weight = 0
  min_players = 40

/datum/round_event/flutes

/datum/round_event/flutes/sound_intro
	for(var/V in GLOB.player_list)
		var/mob/M = V
		if((M.client.prefs.toggles & SOUND_MIDI) && is_station_level(M.z))
			M.playsound_local(M, 'sound/ambience/flutes.ogg', 20, FALSE, pressure_affected = FALSE)

/datum/round_event/flutes/effect(mob/living/M)
  var/mob/living/M = A.affected_mob
  var/flute_effect = 0
    if(prob(15))
      to_chat(M, "<span class='warning'><b>Your vision flickers.</b</span>")
      M.blur_eyes(15)      
	if(prob(20))
		to_chat(M, "<span class='warning'><b>You get an intense headache!</b</span>")
        M.blur_eyes(15) 
        target.adjustOrganLoss(ORGAN_SLOT_BRAIN, 20, 30, 35)
        stamina_damage = 15
	if(prob(30))
		to_chat(M, "<span class='warning'><b>Something trembles along the edge of your vision, your eyes water, with the familiar beat of blood racing through your head.</b</span>)
    	M.blur_eyes(30) 
    	M.adjustOrganLoss(ORGAN_SLOT_BRAIN, 30, 35)
    	stamina_damage = 30
     if(prob(35))
        to_chat(M, "<span class ='cultlarge'><b>You hear faint chanting.. You feel a heavy weight upon your shoulders, as something shifts it's gaze towards you..</b></span>")
		M.blur_eyes(30)
		M.adjustOrganLoss(ORGAN_SLOT_BRAIN, 50, 60)
		stamina_damage = 50
		ADD_TRAIT(M, TRAIT_UNSTABLE)
		sanity = 75
	if(prob(40))
		to_chat(M, "<span class='warning'><b>As the nearest stars light your skin and your station, you can make out the faint whispers being spoken in turn with the monotone flutes playing beyond you. You feel so tired, as the struts of metal piping, the walls, the floor twist in unnatural ways, as the lights dim.</b></span>
		sleep(30)
		M.blur_eyes(40)
		M.adjustOrganLoss(ORGAN_SLOT_BRAIN, 65, 70, 80)
		ADD_TRAIT(M, TRAIT_UNSTABLE)
		sanity = 50
		sleep(25)
		to_chat(M, "<span class='warning'><b>Exhaustion takes you.</b></span>"
		M.Unconscious(70)
		to_chat(M, "<span class='notice'><b>You see vague, inhuman forms, in the tightest corners of your alien dreams, dancing frantically to thundering drums, in tune with yellow monotone flutes.</b></span>"
		sleep(25)
		brute_damage = 15
		to_chat(M, "<span class='notice'><b>You wake from your deep dreams, blood oozing from your nose, while your head beats to a familiar tune.</b></span>"
	if(prob(50))
		to_chat(M, "<span class='notice'><b>You glance upwards, down the corridor.</b></span>"
		sleep(5)
		to_chat(M, "span class='bold large_brass'><b>A BRIGHT BLINDING LIGHT FILLS YOUR VISION!</b></span>"
		M.eye_blind = 5
		sleep(5)
		to_chat(M, "<span class='reallybig hypnophrase'><b>Your mind oozes at what it cannot comprehend, you feel your soul snatching onto your brain, with chills rolling up your spine. "You" barely hang on.</b></span>"
		if(HAS_TRAIT(M, TRAIT_UNSTABLE))
			to_chat(M, "<span class='green'><b>Your mind shatters.</b></span>
			M.Unconcious(30)
			sleep(30)
			to_chat(M, "<span class='suicide'><b>Your flesh undulates, and boils off your bones. You were blind, yet now you've seen a glimpse behind the cosmic curtain.</b></span>
			sanity = 25
			REMOVE_TRAIT(M, TRAIT_UNSTABLE)
			M.blur_eyes(5)
			stamina_damage = 90
			brute_damage = 90
			target.adjustOrganLost(ORGAN_SLOT_BRAIN, 90)
			M.set_species(/datum/species/skeleton)
			sleep(30)
			to_chat(M, <"span class='warning'><b>Your mind.. Has been humbled. You have escaped by the skin of your teeth, but have lost your body, and much, much more. You feel.. Mirth?</b></span>
		else if !(HAS_TRAIT(M, TRAIT_UNSTABLE))
		to_chat(M, "span class='suicide'><b>Your mind shatters.</b></span>
		ADD_TRAIT(M, TRAIT_UNSTABLE)
		sanity = 1
		M.Unconcious(30)
		M.blur_eyes(40)
		stamina_damage = 99
		to_chat(M, <"span class='Narsie'><b>Y'HAH HT'HU THRZHZU. UA'KLL GHRT AWN ZUU!</b></span>
		brute_damage = (99, 99.5, 99.9)
		M.adjustOrganLost(ORGAN_SLOT_BRAIN, 99.9)
		

